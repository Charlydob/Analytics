<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no" />
<title>YT Param Lab · settings</title>

<link rel="manifest" href="./manifest.json" />
<meta name="theme-color" content="#0b1220" />

<link rel="apple-touch-icon" href="./public/icons/icon-180.png" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="mobile-web-app-capable" content="yes" />

<link rel="stylesheet" href="./public/styles/app.css" />

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script src="./src/ui.js"></script>
<script src="./src/firebase/init.js"></script>
<script src="./src/firebase/rtdb.js"></script>
<script src="./src/store/offlineQueue.js"></script>
<script src="./src/store/store.js"></script>

<script src="./src/views/settings.js"></script>
<script src="./src/main.js"></script>
</head>
<body data-page="settings">
  <div id="app">
    <header class="topbar">
      <div class="brand">YT Param Lab</div>
      <nav class="tabs" id="navTabs">
        <a href="./index.html">Home</a>
        <a href="./videos.html">Vídeos</a>
        <a href="./experiments.html">Experimentos</a>
        <a href="./settings.html" class="active">Ajustes</a>
      </nav>
    </header>

    <main id="view">
      <section class="card">
        <div>UID: <span id="uidSpan" class="badge">—</span></div>
        <div>Email: <span id="emailSpan" class="badge">(cargando)</span></div>
        <div>Rol: <span id="roleBadge" class="badge">—</span></div>
        <hr/>

        <!-- Bloque: convertir anónimo → email (conserva UID) -->
        <div id="blockAnon">
          <div class="hint">Convierte esta sesión anónima a email para conservar <b>este mismo UID</b> en todos tus dispositivos.</div>
          <div class="row" style="margin-top:8px">
            <input id="emConvert" class="input" placeholder="email" />
          </div>
          <div class="row" style="margin-top:8px">
            <input id="pwConvert" class="input" type="password" placeholder="contraseña (mín. 6)" />
          </div>
          <div class="row" style="margin-top:8px">
            <button class="btn primary" id="btnConvertAnon">Convertir a email (conservar UID)</button>
          </div>
        </div>

<!-- Bloque: sesión con email (siempre visible) -->
<div id="blockLogged">
  <div class="section">
    <div class="hint">Iniciar sesión / Crear cuenta</div>
    <div class="row" style="margin-top:8px">
      <input id="emLogin" class="input" placeholder="email" />
    </div>
    <div class="row" style="margin-top:8px">
      <input id="pwLogin" class="input" type="password" placeholder="contraseña" />
    </div>
    <div class="row" style="margin-top:8px; gap:8px">
      <button class="btn" id="btnLogin">Iniciar sesión</button>
      <button class="btn" id="btnReset">Recuperar contraseña</button>
      <button class="btn" id="btnLogout">Cerrar sesión</button>
    </div>
    <div class="hint small">Si el email no existe, se creará y se marcará como <b>OWNER</b>.</div>
  </div>
</div>

        <hr/>
        <button class="btn" id="btnExport">Export JSON</button>
        <input type="file" id="imp" accept=".json" style="display:none"/>
        <button class="btn" id="btnImport">Import JSON</button>
      </section>
    </main>

    <nav class="fabbar">
      <button id="fabAdd" title="Añadir vídeo">＋</button>
    </nav>
    <div id="toast" class="toast"></div>
  </div>

  <!-- Fallback por si el boot no llama a la página -->
  <script>
    document.addEventListener('DOMContentLoaded', function(){
      if (window.App && App.Pages && typeof App.Pages.settings === 'function') {
        App.Pages.settings();
      }
    });
  </script>
</body>
</html>
